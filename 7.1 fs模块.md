# fs模块
fs(file System)是用来操作文件系统的一个核心模块。

文件:新增、修改(读写)、删除、复制

文件夹：创建、删除

## 使用fs模块

要使用fs模块需要通过如下命令该模块。
```
var fs = require('fs')
```

> 模块中所有方法都有同步和异步两种形式。

异步形式始终以完成回调作为它最后一个参数。 传给完成回调的参数取决于具体方法，但第一个参数总是留给异常。 如果操作成功完成，则第一个参数会是 null 或 undefined。

当使用同步形式时，任何异常都会被立即抛出。 可以使用 try/catch 来处理异常，或让它们往上冒泡。
### 常用操作
文件的操作：打开、读取、修改、关闭、删除、拷贝

| 方法 | 描述 |
|-----------|------------------------------------|
| fs.readFile(filename,[option],callback)| 异步读取文件 |
| fs.readFileSync(file[, options]) | 同步读取文件 |
| fs.writeFile(filename,data,[options],callback) | 异步写入文件 |
| fs.writeFileSync(file, data[, options]) | 同步写入文件 |
| fs.appendFile(file,data,[,options],callback()) | 异步追加写入文件末尾 |
| fs.appendFileSync(file, data[, options]) | 同步追加写入文件末尾 |
| fs.unlink(path,callback) | 异步删除文件 |
| fs.unlinkSync(path) | 同步删除文件 |

文件夹的操作：创建、删除、修改、遍历

| 方法 | 描述 |
|-----------|------------------------------------|
| fs.mkdir(path,[mode],callback) | 异步创建目录(创建目录时，父目录必须存在) |
| fs.mkdirSync(path[, mode]) | 同步创建目录 |
| fs.rmdir(path,callback) | 异步删除目录 |
| fs.rmdirSync(path) | 同步删除目录 |
| fs.readdir(path,callback) | 读取目录下所有文件 |

其它常用文件操作

| 方法 | 描述 |
|-----------|------------------------------------|
| fs.existsSync(path) | 判断文件或文件夹是否存在，如果文件存在，则返回 true，否则返回 false。 |
| fs.rename(oldPath,newPath,callback) | 异步重命名文件 |
| fs.renameSync(oldPath, newPath)    | 同步重命名文件 |
| fs.stat(path, callback) | 异步查看文件或文件夹状态 callback(err,stats) |
| fs.statSync(path) | 异步查看文件或文件夹状态 ，path 返回一个 fs.Stats 实例|
| stats.isFile() | 判断是否为文件 |
| stats.isDirectory() | 判断是否为目录 |



## 文件操作

flags参数可以是一下值：

|Flag |描述 |
|-----------|:----------:|
|r |以读取模式打开文件，如果文件不存在抛出异常|
|r+ |以读写模式打开文件，如果文件不存在抛出异常|
|rs |以同步的方式读取文件|
|rs+ |以同步的方式读取和写入文件|
|w |以写入模式打开文件，如果文件不存在则创建|
|wx |类似'w'，但是如果文件路径存在，则文件写入失败|
|w+ |以读写模式打开文件，如果文件不存在则创建|
|wx+ |类似'w+'，但是如果文件路径存在，则文件读写失败|
|a |以追加模式打开文件，如果文件不存在则创建|
|ax |类似'a'，但是如果文件路径存在，则文件追加失败|
|a+ |以读取追加模式打开文件，如果文件不存在则创建|
|ax+ |类似'a+'，但是如果文件路径存在，则文件读取追加失败|

### readFile异步读取文件
```
fs.readFile(filename,[option],callback)
```
参数说明：
- filename String 文件名
- option Object
    - encoding String |null default=null 如果字符编码未指定，则返回原始的 buffer。
    - flag String default='r'
- callback Function 回调有两个参数 (err, data)，其中 data 是文件的内容。

```
var fs = require('fs');
fs.readFile('./test.txt',function(err,data){
	if(err){
		console.error(err);
		return ;
	}
	console.log(data);
})
console.log('OK')
```
结果:
```
OK
<Buffer 68 65 6c 6c 6f 21>
```
如果字符编码未指定，则返回原始的 buffer。

> 异步方法不会阻塞主进程，不会影响后续代码执行

### readFileSync同步读取文件
```
fs.readFileSync(file[, options])
```
参数说明：
- filename String 文件名
- option Object
    - encoding String |null default=null 如果字符编码未指定，则返回原始的 buffer。
    - flag String default='r'

```
var fs = require('fs');
try{
	var data = fs.readFileSync('./test.txt');
	console.log(data);
}catch (err){
	console.error(err);
}
console.log('OK')
```
结果
```
<Buffer 68 65 6c 6c 6f 21>
OK
```
> 同步方法会阻塞主进程的执行，在数据没有返回之前不能执行后续代码
> 同步方法不需要传递回调函数，通过函数返回值接受结果

### writeFile异步写入文件
```
fs.writeFile(filename,data,[options],callback)
```
异步地写入数据到文件，如果文件已经存在，则替代文件。 data 可以是一个字符串或一个 buffer。

如果 data 是一个 buffer，则忽略 encoding 选项。它默认为 'utf8'。

参数说明：
- filename String 文件名
- data String  buffer
- option Object
    - encoding String |null default='utf-8'
    - mode Number default=438(aka 0666 in Octal) 表示当前文件的操作权限
    - flag Stringdefault='w'
- callback Function

```
var fs = require('fs');
var buf = Buffer.from('hello');
// 写入文件内容（如果文件不存在会创建一个文件）
// 写入时会先清空文件
fs.writeFile('./test.txt',buf,function (err) {
	if(err)throw err;
})
fs.writeFile('./test.txt','ok?',{flag:'a'},function (err) {
	if(err)throw err;
})
```
### writeFileSync同步写入文件
```
fs.writeFileSync(file, data[, options])
```
参数说明：
- file String   Buffer
- data String   Buffer
- options Object   String
    - encoding String   Null 默认 = 'utf8'
    - mode Integer 默认 = 0o666
    - flag String 默认 = 'w'

fs.writeFile() 的同步版本。返回 undefined。